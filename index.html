<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aplikacja do nauki s≈Çownictwa angielskiego na poziomie B1/B2">
    <meta name="theme-color" content="#1e3a8a">
    <title>English Flashcards B1/B2</title>
    
    <!-- Critical CSS - inline dla szybkiego ≈Çadowania -->
    <style>
        :root{--blue-50:#eff6ff;--blue-100:#dbeafe;--blue-200:#bfdbfe;--blue-300:#93c5fd;--blue-400:#60a5fa;--blue-500:#3b82f6;--blue-600:#2563eb;--blue-700:#1d4ed8;--blue-800:#1e40af;--blue-900:#1e3a8a;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-400:#9ca3af;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;--gray-800:#1f2937;--gray-900:#111827;--green-400:#4ade80;--green-500:#22c55e;--red-400:#f87171;--red-500:#ef4444;--yellow-400:#facc15;--yellow-500:#eab308;--gradient-primary:linear-gradient(135deg,var(--blue-600),var(--blue-800));--gradient-secondary:linear-gradient(135deg,var(--gray-100),var(--gray-200));--shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);--shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);--shadow-md:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);--shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);--shadow-xl:0 20px 25px -5px rgba(0,0,0,0.1),0 10px 10px -5px rgba(0,0,0,0.04);--radius-none:0;--radius-sm:0.125rem;--radius:0.25rem;--radius-md:0.375rem;--radius-lg:0.5rem;--radius-xl:0.75rem;--radius-2xl:1rem;--radius-full:9999px}
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        html{font-size:16px;scroll-behavior:smooth}
        body{font-family:system-ui,-apple-system,sans-serif;background:var(--gradient-primary);min-height:100vh;color:var(--gray-900)}
        body.loading{overflow:hidden}
        .loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--gradient-primary);display:flex;align-items:center;justify-content:center;z-index:9999;opacity:1;transition:opacity 0.3s}
        .loading-content{text-align:center;color:white}
        .loading-spinner{width:40px;height:40px;border:3px solid rgba(255,255,255,0.3);border-top:3px solid #fff;border-radius:50%;animation:spin 1s linear infinite;margin:1.5rem auto}
        @keyframes spin{to{transform:rotate(360deg)}}
        .app-container{min-height:100vh}
        .container{max-width:1200px;margin:0 auto;padding:0 1rem}
        .hidden{display:none!important}
    </style>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/main.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="js/app.js" as="script">
    
    <!-- Non-critical CSS -->
    <link rel="stylesheet" href="css/themes.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/components.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/responsive.css" media="print" onload="this.media='all'">
    
    <!-- Fallback for no-JS -->
    <noscript>
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/themes.css">
        <link rel="stylesheet" href="css/components.css">
        <link rel="stylesheet" href="css/responsive.css">
    </noscript>
</head>
<body class="loading">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo" style="font-size:3rem;margin-bottom:1rem;animation:pulse 2s infinite">üá¨üáß</div>
            <h2 style="font-size:1.5rem;font-weight:bold;margin-bottom:1.5rem;text-shadow:0 2px 4px rgba(0,0,0,0.3)">English Flashcards B1/B2</h2>
            <div class="loading-spinner"></div>
            <p id="loading-message" style="font-size:1.125rem;opacity:0.9">≈Åadowanie aplikacji...</p>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container hidden">
        <!-- Zawarto≈õƒá aplikacji zostanie wygenerowana dynamicznie -->
    </div>

    <!-- Notifications Container -->
    <div id="notifications-container" class="notifications-container" aria-live="polite" role="status"></div>

    <!-- Offline indicator -->
    <div id="offline-indicator" class="offline-indicator hidden" role="alert">
        <span class="icon" aria-hidden="true">üì∂</span>
        <span class="text">Aplikacja dzia≈Ça offline</span>
    </div>

    <!-- JavaScript Modules - POPRAWIONA KOLEJNO≈öƒÜ BEZ CYKLICZNYCH ZALE≈ªNO≈öCI -->
    <script>
        // Critical error handling
        window.addEventListener('error', function(e) {
            console.error('Critical error:', e.error);
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.innerHTML = `
                    <div style="text-align:center;color:white;padding:20px">
                        <h2>‚ö†Ô∏è B≈ÇƒÖd ≈Çadowania</h2>
                        <p>Aplikacja nie mo≈ºe siƒô za≈Çadowaƒá. Spr√≥buj od≈õwie≈ºyƒá stronƒô.</p>
                        <button onclick="location.reload()" style="background:#1e3a8a;color:white;border:none;padding:10px 20px;border-radius:8px;margin-top:10px">
                            Od≈õwie≈º stronƒô
                        </button>
                    </div>
                `;
            }
        });

        // Performance mark
        performance.mark('app-start');
        
        console.log('üöÄ Rozpoczynam ≈Çadowanie aplikacji English Flashcards...');
    </script>
    
    <!-- 1. CORE MODULES - Podstawowe narzƒôdzia (BEZ ZALE≈ªNO≈öCI) -->
    <script src="js/config/constants.js"></script>
    <script src="js/utils/utils.js"></script>
    <script src="js/utils/storage-manager.js"></script>
    
    <!-- 2. THEME MANAGER - PRZENIESIONY PRZED NOTIFICATION MANAGER! -->
    <script src="js/modules/theme-manager.js"></script>
    
    <!-- 3. NOTIFICATION MANAGER - TERAZ MO≈ªE BEZPIECZNIE U≈ªYWAƒÜ THEME MANAGER -->
    <script src="js/utils/notification-manager.js"></script>
    
    <!-- 4. POZOSTA≈ÅE MANAGER MODULES - W KOLEJNO≈öCI ZALE≈ªNO≈öCI -->
    <script src="js/modules/data-loader.js"></script>
    <script src="js/modules/audio-manager.js"></script>
    <script src="js/modules/image-manager.js"></script>
    <script src="js/modules/progress-manager.js"></script>
    <script src="js/modules/flashcard-manager.js"></script>
    <script src="js/modules/quiz-manager.js"></script>
    
    <!-- 5. MODULE SYSTEM - System ≈Çadowania modu≈Ç√≥w -->
    <script src="js/modules/module-loader.js"></script>
    
    <!-- 6. MAIN APPLICATION - G≈Ç√≥wna aplikacja -->
    <script src="js/app.js"></script>

    <!-- Service Worker Registration - TYLKO DLA HTTP/HTTPS -->
    <script>
        if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js', {
                        scope: '/'
                    });
                    console.log('SW registered:', registration.scope);
                    
                    // Listen for updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // New content available
                                if (window.NotificationManager) {
                                    NotificationManager.show('Nowa wersja dostƒôpna. Od≈õwie≈º stronƒô.', 'info', 0);
                                }
                            }
                        });
                    });
                } catch (error) {
                    console.log('SW registration failed:', error);
                }
            });
        }
    </script>
</body>
</html>