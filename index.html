<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aplikacja do nauki słownictwa angielskiego na poziomie B1/B2">
    <meta name="theme-color" content="#1e3a8a">
    <title>English Flashcards B1/B2</title>
    
    <!-- Critical CSS - inline dla szybkiego ładowania -->
    <style>
        :root{--blue-50:#eff6ff;--blue-100:#dbeafe;--blue-200:#bfdbfe;--blue-300:#93c5fd;--blue-400:#60a5fa;--blue-500:#3b82f6;--blue-600:#2563eb;--blue-700:#1d4ed8;--blue-800:#1e40af;--blue-900:#1e3a8a;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-400:#9ca3af;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;--gray-800:#1f2937;--gray-900:#111827;--green-400:#4ade80;--green-500:#22c55e;--red-400:#f87171;--red-500:#ef4444;--yellow-400:#facc15;--yellow-500:#eab308;--gradient-primary:linear-gradient(135deg,var(--blue-600),var(--blue-800));--gradient-secondary:linear-gradient(135deg,var(--gray-100),var(--gray-200));--shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);--shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);--shadow-md:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);--shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);--shadow-xl:0 20px 25px -5px rgba(0,0,0,0.1),0 10px 10px -5px rgba(0,0,0,0.04);--radius-none:0;--radius-sm:0.125rem;--radius:0.25rem;--radius-md:0.375rem;--radius-lg:0.5rem;--radius-xl:0.75rem;--radius-2xl:1rem;--radius-full:9999px}
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        html{font-size:16px;scroll-behavior:smooth}
        body{font-family:system-ui,-apple-system,sans-serif;background:var(--gradient-primary);min-height:100vh;color:var(--gray-900)}
        body.loading{overflow:hidden}
        .loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--gradient-primary);display:flex;align-items:center;justify-content:center;z-index:9999;opacity:1;transition:opacity 0.3s}
        .loading-content{text-align:center;color:white}
        .loading-spinner{width:40px;height:40px;border:3px solid rgba(255,255,255,0.3);border-top:3px solid #fff;border-radius:50%;animation:spin 1s linear infinite;margin:1.5rem auto}
        @keyframes spin{to{transform:rotate(360deg)}}
        .app-container{min-height:100vh}
        .container{max-width:1200px;margin:0 auto;padding:0 1rem}
        .hidden{display:none!important}
    </style>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/main.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="js/app.js" as="script">
    
    <!-- Non-critical CSS -->
    <link rel="stylesheet" href="css/themes.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/components.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/responsive.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/difficulty-styles.css" media="print" onload="this.media='all'">
    <!-- Image Modal Styles -->
    <link rel="stylesheet" href="css/image-modal.css" media="print" onload="this.media='all'">
    
    <!-- Fallback for no-JS -->
    <noscript>
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/difficulty-styles.css">
        <link rel="stylesheet" href="css/themes.css">
        <link rel="stylesheet" href="css/components.css">
        <link rel="stylesheet" href="css/responsive.css">
        <link rel="stylesheet" href="css/3d-fixes.css">
        <link rel="stylesheet" href="css/image-modal.css">
        
    </noscript>
</head>
<body class="loading">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo" style="font-size:3rem;margin-bottom:1rem;animation:pulse 2s infinite">🇬🇧</div>
            <h2 style="font-size:1.5rem;font-weight:bold;margin-bottom:1.5rem;text-shadow:0 2px 4px rgba(0,0,0,0.3)">English Flashcards B1/B2</h2>
            <div class="loading-spinner"></div>
            <p id="loading-message" style="font-size:1.125rem;opacity:0.9">Ładowanie aplikacji...</p>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo-section">
                        <h1>
                            <span class="flag">🇬🇧</span>
                            English B1/B2
                            <span class="flag">🇺🇸</span>
                        </h1>
                        <p class="subtitle">1600+ słów w 32 kategoriach</p>
                    </div>
                    
                    <!-- Header Controls -->
                    <div class="header-controls">
                        <button class="control-btn" id="theme-toggle" title="Zmień motyw">
                            <span class="icon">🌙</span>
                            <span class="text">Tryb ciemny</span>
                        </button>
                        
                        <!-- ✨ NOWY PRZYCISK ULUBIONYCH -->
                        <button class="control-btn" id="bookmarks-toggle" title="Pokaż słowa do powtórzenia">
                            <span class="icon">🔖</span>
                            <span class="text">Powtórka</span>
                            <span class="count-badge" style="display: none;">0</span>
                        </button>
                        
                        <button class="control-btn" id="stats-toggle" title="Pokaż statystyki">
                            <span class="icon">📊</span>
                            <span class="text">Statystyki</span>
                        </button>
                        <button class="control-btn" id="settings-toggle" title="Ustawienia">
                            <span class="icon">⚙️</span>
                            <span class="text">Ustawienia</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Stats Panel -->
        <div id="stats-panel" class="stats-panel">
            <div class="container">
                <div class="stats-content">
                    <h3>📈 Twoje statystyki nauki</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="total-studied">0</div>
                            <div class="stat-label">Przejrzane karty</div>
                            <div class="stat-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="cards-progress"></div>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="study-streak">0</div>
                            <div class="stat-label">Dni z rzędu</div>
                            <div class="stat-icon">🔥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="quiz-score">0%</div>
                            <div class="stat-label">Średni wynik quizów</div>
                            <div class="stat-icon">🎯</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="favorite-category">-</div>
                            <div class="stat-label">Ulubiona kategoria</div>
                            <div class="stat-icon">⭐</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-words">1600+</div>
                            <div class="stat-label">Dostępne słowa</div>
                            <div class="stat-icon">📚</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="completed-categories">0/32</div>
                            <div class="stat-label">Ukończone kategorie</div>
                            <div class="stat-icon">✅</div>
                        </div>

                        <!-- ✨ NOWA KARTA: Ulubione słowa -->
                        <div class="stat-card bookmark-stat-card">
                            <div class="stat-value" id="total-bookmarks-stat">0</div>
                            <div class="stat-label">Słowa do powtórki</div>
                            <div class="stat-icon">🔖</div>
                            <button class="stat-action-btn" id="bookmarks-stats-btn" title="Otwórz powtórkę">
                                <span>Zobacz wszystkie</span>
                            </button>
                        </div>
                        
                        <!-- ✨ NOWA KARTA: Najczęściej ulubiona kategoria -->
                        <div class="stat-card">
                            <div class="stat-value" id="top-bookmark-category">-</div>
                            <div class="stat-label">Najczęściej ulubiona</div>
                            <div class="stat-icon">🏆</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Mode Selector -->
                <div class="mode-selector">
                    <button class="mode-btn active" id="flashcards-mode" data-mode="flashcards">
                        <span class="icon">📚</span>
                        <span class="text">Fiszki</span>
                    </button>
                    <button class="mode-btn" id="quiz-mode" data-mode="quiz">
                        <span class="icon">🎯</span>
                        <span class="text">Quizy</span>
                    </button>
                    <button class="mode-btn" id="sentences-mode" data-mode="sentences">
                        <span class="icon">💬</span>
                        <span class="text">Przykłady zdań</span>
                    </button>
                </div>
                
                <div id="quick-access-panel" class="quick-access-panel">
                <h3>🚀 Szybki dostęp</h3>
                <div class="quick-access-grid">
                    
                    <!-- ✨ Przycisk nauki tylko ulubionych -->
                    <button class="quick-access-btn bookmarks-study-btn" id="study-bookmarks-quick" 
                            title="Ucz się tylko słów do powtórki">
                        <div class="quick-btn-icon">🔖</div>
                        <div class="quick-btn-content">
                            <div class="quick-btn-title">Powtarzaj zapisane słownictwo</div>
                            <div class="quick-btn-subtitle">
                                <span id="bookmarks-count-quick">0</span> słów
                            </div>
                        </div>
                    </button>
                    
                    <!-- ✨ Przycisk przeglądania ulubionych -->
                    <button class="quick-access-btn" id="browse-bookmarks-quick" 
                            title="Przeglądaj wszystkie słowa do powtórki">
                        <div class="quick-btn-icon">📚</div>
                        <div class="quick-btn-content">
                            <div class="quick-btn-title">Przeglądaj słowa do powtórki</div>
                            <div class="quick-btn-subtitle">Zarządzaj listą</div>
                        </div>
                    </button>
                    
                    <!-- ✨ Przycisk losowego quizu z ulubionych -->
                    <button class="quick-access-btn" id="quiz-bookmarks-quick" 
                            title="Quiz z słów do powtórki">
                        <div class="quick-btn-icon">🎯</div>
                        <div class="quick-btn-content">
                            <div class="quick-btn-title">Quiz z powtórek</div>
                            <div class="quick-btn-subtitle">Test wiedzy</div>
                        </div>
                    </button>
                    
                </div>
            </div>

                <!-- Category Selector -->
                <div id="category-selector" class="category-selector">
                    <div class="category-search">
                        <input type="text" id="category-search" placeholder="🔍 Szukaj kategorii..." class="search-input">
                    </div>
                    <div id="category-grid" class="category-grid">
                        <!-- Categories will be loaded dynamically -->
                    </div>
                </div>

                <!-- Quiz Selector -->
                <div id="quiz-selector" class="quiz-selector" style="display: none;">
                    <div class="quiz-sections">
                        <!-- Category Quizzes -->
                        <section class="quiz-section">
                            <h3>🎯 Quizy kategorii (15 pytań, zalicz 12)</h3>
                            <div id="category-quiz-grid" class="quiz-grid">
                                <!-- Category quizzes will be loaded dynamically -->
                            </div>
                        </section>

                        <!-- Mixed Quizzes -->
                        <section class="quiz-section">
                            <h3>🔄 Quizy mieszane</h3>
                            <div class="quiz-grid">
                                <button class="quiz-card mixed-quiz" id="random-quiz-btn">
                                    <span class="quiz-icon">🎲</span>
                                    <span class="quiz-name">Quiz losowy</span>
                                    <span class="quiz-description">20 losowych słów</span>
                                    <span class="quiz-status">Zawsze dostępny</span>
                                </button>
                                
                                <!-- ZMIANA: Zaktualizuj z difficult-words na bookmarks -->
                                <button class="quiz-card mixed-quiz" id="bookmarks-quiz-btn">
                                    <span class="quiz-icon">🔖</span>
                                    <span class="quiz-name">Quiz z powtórek</span>
                                    <span class="quiz-description">Słowa do powtórki</span>
                                    <span class="quiz-status">Wymaga 3+ słów</span>
                                </button>
                                
                                <!-- NOWE: Dodaj nowe typy quizów -->
                                <button class="quiz-card mixed-quiz" id="speed-quiz-btn">
                                    <span class="quiz-icon">⚡</span>
                                    <span class="quiz-name">Quiz błyskawiczny</span>
                                    <span class="quiz-description">10 pytań, 30s każde</span>
                                    <span class="quiz-status">Zawsze dostępny</span>
                                </button>
                                
                                <button class="quiz-card mixed-quiz" id="mixed-quiz-btn">
                                    <span class="quiz-icon">🎯</span>
                                    <span class="quiz-name">Quiz mieszany</span>
                                    <span class="quiz-description">Wybrane kategorie</span>
                                    <span class="quiz-status">Dostępny</span>
                                </button>
                            </div>
                        </section>

                        <!-- NOWA SEKCJA: Quizy trudności -->
                        <section class="quiz-section">
                            <h3>⭐ Quizy poziomów trudności</h3>
                            <div class="quiz-grid">
                                <button class="quiz-card difficulty-quiz easy-quiz" id="easy-words-quiz-btn">
                                    <span class="quiz-icon">⭐</span>
                                    <span class="quiz-name">Quiz łatwych słów</span>
                                    <span class="quiz-description">Słowa oznaczone jako łatwe</span>
                                    <span class="quiz-status" id="easy-quiz-status">Brak słów</span>
                                </button>
                                
                                <button class="quiz-card difficulty-quiz hard-quiz" id="hard-words-quiz-btn">
                                    <span class="quiz-icon">⭐⭐⭐</span>
                                    <span class="quiz-name">Quiz trudnych słów</span>
                                    <span class="quiz-description">Słowa oznaczone jako trudne</span>
                                    <span class="quiz-status" id="hard-quiz-status">Brak słów</span>
                                </button>
                                
                                <button class="quiz-card difficulty-quiz progressive-quiz" id="progressive-quiz-btn">
                                    <span class="quiz-icon">📈</span>
                                    <span class="quiz-name">Quiz progresywny</span>
                                    <span class="quiz-description">Od łatwych do trudnych</span>
                                    <span class="quiz-status" id="progressive-quiz-status">Niedostępny</span>
                                </button>
                                
                                <button class="quiz-card difficulty-quiz adaptive-quiz" id="adaptive-quiz-btn">
                                    <span class="quiz-icon">🧠</span>
                                    <span class="quiz-name">Quiz adaptacyjny</span>
                                    <span class="quiz-description">Dostosowany do Twojego poziomu</span>
                                    <span class="quiz-status" id="adaptive-quiz-status">Niedostępny</span>
                                </button>
                            </div>
                        </section>

                        <!-- Final Quiz -->
                        <section class="quiz-section">
                            <h3>🏆 Quiz końcowy (50 pytań, zalicz 42)</h3>
                            <div class="quiz-grid">
                                <button class="quiz-card final-quiz" id="final-quiz-btn">
                                    <span class="quiz-icon">🎓</span>
                                    <span class="quiz-name">Test ze wszystkich kategorii</span>
                                    <span class="quiz-description">50 pytań z całego materiału</span>
                                    <span class="quiz-status" id="final-quiz-status">Niedostępny</span>
                                </button>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Flashcard Container -->
                <div id="flashcard-container" class="flashcard-container">
                    <div class="flashcard-wrapper">
                        <div class="flashcard" id="flashcard">
                            <div class="card-face card-front" id="card-front">
                                <!-- Front content will be inserted here -->
                            </div>
                            <div class="card-face card-back" id="card-back">
                                <!-- Back content will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quiz Container -->
                <div id="quiz-container" class="quiz-container" style="display: none;">
                    <div class="quiz-header">
                        <div class="quiz-info">
                            
                            <div class="quiz-controls">
                            <h3 id="quiz-title">Quiz: Build and Appearance</h3><button class="quiz-btn cancel" id="quiz-cancel-btn" title="Przerwij quiz">
                                <span class="icon">❌</span>
                                <span class="text">Przerwij</span>
                            </button>
                        </div><div class="quiz-progress">
                                <span class="progress-text">
                                    Pytanie <span id="quiz-current">1</span> z <span id="quiz-total">15</span>
                                </span>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="quiz-progress-fill" style="width: 6.66667%;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ✨ NOWY PRZYCISK PRZERWANIA QUIZU -->
                        

                        <div class="quiz-score">
                            <span class="score-label">Wynik:</span>
                            <span class="score-value" id="quiz-score-display">0/0</span>
                        </div>
                    </div>
                    
                    <div class="quiz-timer" id="quiz-timer" style="display: none;">
                        <span class="timer-label">Czas:</span>
                        <span class="timer-value" id="timer-value">30</span>
                        <div class="timer-bar">
                            <div class="timer-fill" id="timer-fill"></div>
                        </div>
                    </div>

                    <div class="quiz-content">
                        <div class="quiz-question-card">
                            <div class="question-section">
                                <div class="english-word" id="quiz-english-word">beautiful</div>
                                <div class="quiz-instruction">Wybierz poprawne polskie tłumaczenie:</div>
                            </div>
                            
                            <!-- Multiple Choice Quiz -->
                            <div id="multiple-choice-section" class="answer-section">
                                <div class="answer-options" id="answer-options">
                                    <!-- Options will be inserted here -->
                                </div>
                            </div>
                            
                            <!-- Text Input Quiz -->
                            <div id="text-input-section" class="answer-section" style="display: none;">
                                <div class="input-group">
                                    <input type="text" id="quiz-answer-input" class="quiz-input" 
                                           placeholder="Wpisz polskie tłumaczenie..." autocomplete="off">
                                    <button class="quiz-btn primary" id="quiz-submit-btn">Sprawdź</button>
                                </div>
                            </div>
                            
                            <!-- Sentence Quiz -->
                            <div id="sentence-section" class="answer-section" style="display: none;">
                                <div class="sentence-question">
                                    <p class="instruction">Przetłumacz zdanie:</p>
                                    <p class="sentence-text" id="sentence-to-translate"></p>
                                </div>
                                <div class="input-group">
                                    <textarea id="sentence-answer" class="sentence-input" 
                                              placeholder="Wpisz tłumaczenie zdania..." rows="3"></textarea>
                                    <button class="quiz-btn primary" id="sentence-submit-btn">Sprawdź</button>
                                </div>
                            </div>
                            
                            <!-- Quiz Feedback -->
                            <div id="quiz-feedback" class="quiz-feedback" style="display: none;">
                                <div class="feedback-content">
                                    <div class="feedback-icon" id="feedback-icon">✅</div>
                                    <div class="feedback-text" id="feedback-text">Poprawnie!</div>
                                    <div class="feedback-details" id="feedback-details"></div>
                                </div>
                                <div class="feedback-actions">
                                    <button class="quiz-btn primary" id="quiz-next-btn">Następne pytanie</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quiz Results -->
                <div id="quiz-results" class="quiz-results" style="display: none;">
                    <div class="results-card">
                        <div class="results-header">
                            <div class="results-icon" id="results-icon">🎉</div>
                            <h3 id="results-title">Gratulacje!</h3>
                        </div>
                        
                        <div class="results-content">
                            <div class="score-display">
                                <div class="score-main">
                                    <span id="results-score">12/15</span>
                                </div>
                                <div class="score-percentage" id="results-percentage">80%</div>
                            </div>
                            
                            <div class="results-status" id="results-status">
                                Quiz zaliczony!
                            </div>
                            
                            <div class="results-details" id="results-details">
                                <!-- Detailed results will be shown here -->
                            </div>
                        </div>
                        
                        <div class="results-actions">
                            <button class="quiz-btn secondary" id="quiz-retry-btn">
                                <span class="icon">🔄</span>
                                <span class="text">Spróbuj ponownie</span>
                            </button>
                            <button class="quiz-btn primary" id="quiz-continue-btn">
                                <span class="icon">➡️</span>
                                <span class="text">Kontynuuj naukę</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Navigation Controls -->
                <div id="navigation-controls" class="navigation-controls">
                    <button class="nav-btn" id="prev-btn">
                        <span class="icon">⬅️</span>
                        <span class="text">Poprzednia</span>
                    </button>
                    <!-- ✨ NOWY PRZYCISK: Tryb ulubionych -->
                    <button class="nav-btn bookmarks-mode-btn" id="bookmarks-mode-toggle" 
                            title="Przełącz tryb nauki tylko powtórka">
                        <span class="icon">🔖</span>
                        <span class="text">Tryb powtórki</span>
                    </button>
                    <button class="nav-btn primary" id="flip-btn">
                        <span class="icon">🔄</span>
                        <span class="text">Obróć fiszkę</span>
                    </button>
                    <button class="nav-btn" id="next-btn">
                        <span class="icon">➡️</span>
                        <span class="text">Następna</span>
                    </button>
                </div>

                <!-- Progress Display -->
                <div id="progress-display" class="progress-display">
                    <div class="progress-info">
                        <span class="progress-text">
                            Karta <span id="current-card">1</span> z <span id="total-cards">50</span>
                        </span>
                        <span class="category-name" id="current-category">Build and Appearance</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-actions">
                        <button class="action-btn" id="shuffle-btn" title="Wymieszaj karty">
                            <span class="icon">🔀</span>
                            <span class="text">Wymieszaj</span>
                        </button>
                        <button class="action-btn" id="reset-btn" title="Resetuj postęp">
                            <span class="icon">🔄</span>
                            <span class="text">Reset</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notifications Container -->
    <div id="notifications-container" class="notifications-container" aria-live="polite" role="status"></div>

    <!-- Offline indicator -->
    <div id="offline-indicator" class="offline-indicator hidden" role="alert">
        <span class="icon" aria-hidden="true">📶</span>
        <span class="text">Aplikacja działa offline</span>
    </div>

    <!-- 🔖 Modal Ulubionych Słów -->
    <div id="bookmarks-modal" class="modal-overlay" style="display: none;">
        <div class="modal bookmarks-modal">
            <!-- 📋 Nagłówek modala -->
            <div class="modal-header">
                <div class="modal-title">
                    <span class="icon">🔖</span>
                    <h3>Ulubione słowa</h3>
                    <span id="bookmarks-count" class="count-badge">0</span>
                </div>
                <button class="modal-close" id="bookmarks-modal-close" aria-label="Zamknij">×</button>
            </div>

            <!-- 📊 Statystyki i kontrolki -->
            <div class="modal-controls">
                <div class="bookmark-stats">
                    <div class="stat-item">
                        <span class="label">Łącznie:</span>
                        <span id="total-bookmarks" class="value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Kategorie:</span>
                        <span id="bookmark-categories" class="value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Ostatnio dodane:</span>
                        <span id="recent-bookmark" class="value">-</span>
                    </div>
                </div>

                <!-- 🔧 Kontrolki akcji -->
                <div class="bookmark-actions">
                    <button id="study-bookmarks-btn" class="btn primary" title="Ucz się zapisanych słów">
                        <span class="icon">📚</span>
                        <span class="text">Powtarzaj zapisane słówka</span>
                    </button>
                    <button id="export-bookmarks-btn" class="btn secondary" title="Eksportuj słowa do powtórki do pliku">
                        <span class="icon">💾</span>
                        <span class="text">Eksportuj</span>
                    </button>
                    <button id="clear-bookmarks-btn" class="btn danger" title="Usuń wszystkie słowa z powtórek">
                        <span class="icon">🗑️</span>
                        <span class="text">Wyczyść</span>
                    </button>
                </div>
            </div>

            <!-- 🔍 Wyszukiwanie i filtrowanie -->
            <div class="modal-filters">
                <div class="search-group">
                    <input 
                        type="text" 
                        id="bookmarks-search" 
                        class="search-input" 
                        placeholder="🔍 Szukaj w powtórkach..."
                        autocomplete="off"
                    >
                </div>
                <div class="filter-group">
                    <select id="bookmarks-category-filter" class="filter-select">
                        <option value="">Wszystkie kategorie</option>
                    </select>
                    <select id="bookmarks-sort" class="filter-select">
                        <option value="recent">Ostatnio dodane</option>
                        <option value="alphabetical">Alfabetycznie</option>
                        <option value="category">Według kategorii</option>
                    </select>
                </div>
            </div>

            <!-- 📚 Lista ulubionych słów -->
            <div class="modal-content bookmarks-content">
                <!-- 🎯 Placeholder gdy brak ulubionych -->
                <div id="no-bookmarks-placeholder" class="placeholder">
                    <div class="placeholder-icon">🔖</div>
                    <h4>Brak słówek do powtórzenia</h4>
                    <p>Dodaj słowa do powtórzenia klikając przycisk 🔖 na fiszce</p>
                    <button class="btn primary" onclick="closeBookmarksModal()">
                        <span class="text">Zacznij naukę</span>
                    </button>
                </div>

                <!-- 📋 Lista słów -->
                <div id="bookmarks-list" class="bookmarks-list">
                    <!-- Słowa będą dodawane dynamicznie przez JavaScript -->
                </div>
            </div>

            <!-- 📄 Paginacja (jeśli dużo słów) -->
            <div id="bookmarks-pagination" class="modal-pagination" style="display: none;">
                <button id="prev-page" class="pagination-btn">‹ Poprzednie</button>
                <span id="page-info" class="page-info">Strona 1 z 1</span>
                <button id="next-page" class="pagination-btn">Następne ›</button>
            </div>
        </div>
    </div>

    <!-- 🎯 MODAL WYBORU KATEGORII DLA QUIZ MIESZANY -->
    <div id="category-selection-modal" class="modal-overlay" style="display: none;">
        <div class="modal category-selection-modal">
            <!-- Nagłówek modala -->
            <div class="modal-header">
                <div class="modal-title">
                    <span class="icon">🎯</span>
                    <h3>Quiz Mieszany - Wybierz kategorie</h3>
                </div>
                <button class="modal-close" id="category-selection-close" aria-label="Zamknij">×</button>
            </div>

            <!-- Informacje o wyborze -->
            <div class="modal-info">
                <div class="selection-summary">
                    <div class="summary-item">
                        <span class="label">Wybrane kategorie:</span>
                        <span id="selected-categories-count" class="value">0</span>
                        <span class="total">/ 32</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Dostępne słowa:</span>
                        <span id="selected-words-count" class="value">0</span>
                    </div>
                </div>
                
                <div class="selection-actions">
                    <button id="select-all-categories" class="btn secondary small">Zaznacz wszystkie</button>
                    <button id="deselect-all-categories" class="btn secondary small">Odznacz wszystkie</button>
                </div>
            </div>

            <!-- Lista kategorii -->
            <div class="modal-content category-selection-content">
                <div class="categories-grid" id="categories-selection-grid">
                    <!-- Kategorie będą dodane dynamicznie przez JavaScript -->
                </div>
            </div>

            <!-- Akcje -->
            <div class="modal-footer">
                <div class="footer-info">
                    <span class="requirement">Minimum 2 kategorie wymagane</span>
                </div>
                <div class="footer-actions">
                    <button id="cancel-category-selection" class="btn secondary">
                        <span class="icon">❌</span>
                        <span class="text">Anuluj</span>
                    </button>
                    <button id="start-mixed-quiz" class="btn primary" disabled>
                        <span class="icon">🚀</span>
                        <span class="text">Uruchom Quiz</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules - POPRAWIONA KOLEJNOŚĆ BEZ CYKLICZNYCH ZALEŻNOŚCI -->
    <script>
        // Critical error handling
        window.addEventListener('error', function(e) {
            console.error('Critical error:', e.error);
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.innerHTML = `
                    <div style="text-align:center;color:white;padding:20px">
                        <h2>⚠️ Błąd ładowania</h2>
                        <p>Aplikacja nie może się załadować. Spróbuj odświeżyć stronę.</p>
                        <button onclick="location.reload()" style="background:#1e3a8a;color:white;border:none;padding:10px 20px;border-radius:8px;margin-top:10px">
                            Odśwież stronę
                        </button>
                    </div>
                `;
            }
        });

        // Performance mark
        performance.mark('app-start');
        
        console.log('🚀 Rozpoczynam ładowanie aplikacji English Flashcards...');
    </script>
    
    <!-- 6. MAIN APPLICATION - Główna aplikacja -->
    <script type="module" src="js/app.js"></script>

    <!-- Service Worker Registration - TYLKO DLA HTTP/HTTPS 
    <script>
        if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js', {
                        scope: '/'
                    });
                    console.log('SW registered:', registration.scope);
                    
                    // Listen for updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // New content available
                                if (window.NotificationManager) {
                                    NotificationManager.show('Nowa wersja dostępna. Odśwież stronę.', 'info', 0);
                                }
                            }
                        });
                    });
                } catch (error) {
                    console.log('SW registration failed:', error);
                }
            });
        }
    </script>-->
</body>
</html>