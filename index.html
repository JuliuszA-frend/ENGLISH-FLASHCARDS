<!DOCTYPE html>
<html lang="pl" data-theme="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Profesjonalna aplikacja do nauki angielskiego poziom B1/B2 z 1600+ s≈Çowami w 32 kategoriach">
    <meta name="keywords" content="angielski, nauka, fiszki, vocabulary, B1, B2, flashcards">
    <meta name="author" content="English Learning App">
    <meta name="theme-color" content="#1e3a8a">
    
    <title>English Flashcards B1/B2 - Nauka Angielskiego</title>
    
    <!-- Manifest PWA -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">
    
    <!-- Critical CSS inline -->
    <style>
        :root{--primary:#1e3a8a;--primary-dark:#1e40af;--primary-light:#3b82f6;--secondary:#059669;--accent:#dc2626;--success:#059669;--warning:#d97706;--error:#dc2626;--info:#0284c7;--white:#ffffff;--black:#000000;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-400:#9ca3af;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;--gray-800:#1f2937;--gray-900:#111827;--gradient-primary:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);--gradient-secondary:linear-gradient(135deg,var(--secondary) 0%,#10b981 100%);--shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);--shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);--shadow-md:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);--shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);--shadow-xl:0 20px 25px -5px rgba(0,0,0,0.1),0 10px 10px -5px rgba(0,0,0,0.04);--radius-none:0;--radius-sm:0.125rem;--radius:0.25rem;--radius-md:0.375rem;--radius-lg:0.5rem;--radius-xl:0.75rem;--radius-2xl:1rem;--radius-full:9999px}
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        html{font-size:16px;scroll-behavior:smooth}
        body{font-family:system-ui,-apple-system,sans-serif;background:var(--gradient-primary);min-height:100vh;color:var(--gray-900)}
        body.loading{overflow:hidden}
        .loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--gradient-primary);display:flex;align-items:center;justify-content:center;z-index:9999;opacity:1;transition:opacity 0.3s}
        .loading-content{text-align:center;color:white}
        .loading-spinner{width:40px;height:40px;border:3px solid rgba(255,255,255,0.3);border-top:3px solid #fff;border-radius:50%;animation:spin 1s linear infinite;margin:1.5rem auto}
        @keyframes spin{to{transform:rotate(360deg)}}
        .app-container{min-height:100vh}
        .container{max-width:1200px;margin:0 auto;padding:0 1rem}
        .hidden{display:none!important}
        .progress-bar{width:200px;height:4px;background:rgba(255,255,255,0.2);border-radius:2px;margin:20px auto;overflow:hidden}
        .progress-fill{height:100%;background:#fbbf24;border-radius:2px;transition:width 0.3s ease;width:0%}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    </style>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/main.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="js/app.js" as="script">
    
    <!-- Non-critical CSS -->
    <link rel="stylesheet" href="css/themes.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/components.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/responsive.css" media="print" onload="this.media='all'">
    
    <!-- Fallback for no-JS -->
    <noscript>
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/themes.css">
        <link rel="stylesheet" href="css/components.css">
        <link rel="stylesheet" href="css/responsive.css">
    </noscript>
</head>
<body class="loading">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo" style="font-size:3rem;margin-bottom:1rem;animation:pulse 2s infinite">üá¨üáß</div>
            <h2 style="font-size:1.5rem;font-weight:bold;margin-bottom:1.5rem;text-shadow:0 2px 4px rgba(0,0,0,0.3)">English Flashcards B1/B2</h2>
            <div class="loading-spinner"></div>
            <p id="loading-message" style="font-size:1.125rem;opacity:0.9">≈Åadowanie aplikacji...</p>
            
            <!-- Progress bar -->
            <div class="progress-bar" id="loading-progress-bar">
                <div class="progress-fill" id="loading-progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container hidden">
        <!-- Zawarto≈õƒá aplikacji zostanie wygenerowana dynamicznie -->
    </div>

    <!-- Notifications Container -->
    <div id="notifications-container" class="notifications-container" aria-live="polite" role="status"></div>

    <!-- Offline indicator -->
    <div id="offline-indicator" class="offline-indicator hidden" role="alert">
        <span class="icon" aria-hidden="true">üì∂</span>
        <span class="text">Aplikacja dzia≈Ça offline</span>
    </div>

    <!-- 1. NAJPIERW - Narzƒôdzia podstawowe -->
    <script src="js/config/constants.js" onerror="handleScriptError('constants.js')"></script>
    <script src="js/utils/utils.js" onerror="handleScriptError('utils.js')"></script>

    <!-- 2. POTEM - NotificationManager (musi byƒá przed innymi managerami) -->
    <script src="js/utils/notification-manager.js" onerror="handleScriptError('notification-manager.js')"></script>

    <!-- 3. NASTƒòPNIE - StorageManager -->
    <script src="js/utils/storage-manager.js" onerror="handleScriptError('storage-manager.js')"></script>

    <!-- 4. POTEM - Pozosta≈Çe managery w kolejno≈õci -->
    <script src="js/modules/theme-manager.js" onerror="handleScriptError('theme-manager.js')"></script>
    <script src="js/modules/data-loader.js" onerror="handleScriptError('data-loader.js')"></script>
    <script src="js/modules/progress-manager.js" onerror="handleScriptError('progress-manager.js')"></script>
    <script src="js/modules/audio-manager.js" onerror="handleScriptError('audio-manager.js')"></script>
    <script src="js/modules/image-manager.js" onerror="handleScriptError('image-manager.js')"></script>
    <script src="js/modules/flashcard-manager.js" onerror="handleScriptError('flashcard-manager.js')"></script>
    <script src="js/modules/quiz-manager.js" onerror="handleScriptError('quiz-manager.js')"></script>

    <!-- 5. NA KO≈ÉCU - G≈Ç√≥wna aplikacja -->
    <script src="js/app.js" onerror="handleScriptError('app.js')"></script>

    <!-- 6. Narzƒôdzie diagnostyczne (opcjonalne) -->
    <script src="js/utils/diagnostic.js" onerror="console.warn('Diagnostic tool not found')"></script>

    <!-- 7. INICJALIZACJA APLIKACJI -->
    <script>
        // ≈öledzenie b≈Çƒôd√≥w ≈Çadowania skrypt√≥w
        let scriptErrors = [];
        
        function handleScriptError(scriptName) {
            scriptErrors.push(scriptName);
            console.error(`‚ùå B≈ÇƒÖd ≈Çadowania skryptu: ${scriptName}`);
        }

        // Funkcja aktualizacji paska postƒôpu
        function updateLoadingProgress(message, percent) {
            const messageEl = document.getElementById('loading-message');
            const progressFill = document.getElementById('loading-progress-fill');
            
            if (messageEl) messageEl.textContent = message;
            if (progressFill) progressFill.style.width = `${percent}%`;
        }

        // Sprawdzenie czy wszystkie klasy sƒÖ za≈Çadowane
        function checkClassAvailability() {
            const requiredClasses = [
                'NotificationManager',
                'ThemeManager', 
                'DataLoader',
                'ProgressManager',
                'AudioManager', 
                'ImageManager',
                'FlashcardManager',
                'QuizManager',
                'EnglishFlashcardsApp'
            ];
            
            const missingClasses = [];
            
            requiredClasses.forEach(className => {
                if (typeof window[className] === 'undefined') {
                    missingClasses.push(className);
                }
            });
            
            if (missingClasses.length > 0) {
                console.error('‚ùå BrakujƒÖce klasy:', missingClasses);
                return { success: false, missing: missingClasses };
            }
            
            console.log('‚úÖ Wszystkie klasy sƒÖ dostƒôpne');
            return { success: true, missing: [] };
        }

        // Pokazanie komunikatu o b≈Çƒôdzie
        function showErrorScreen(title, message, details = null) {
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.innerHTML = `
                    <div style="text-align: center; color: white; padding: 2rem; max-width: 500px;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                        <h2 style="font-size: 1.5rem; margin-bottom: 1rem;">${title}</h2>
                        <p style="margin-bottom: 1rem; opacity: 0.9;">${message}</p>
                        ${details ? `<details style="margin-bottom: 1rem; text-align: left; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 0.5rem;">
                            <summary style="cursor: pointer; font-weight: bold;">Szczeg√≥≈Çy techniczne</summary>
                            <pre style="margin-top: 0.5rem; font-size: 0.875rem; overflow-x: auto;">${details}</pre>
                        </details>` : ''}
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button onclick="location.reload()" style="
                                background: #3b82f6; 
                                color: white; 
                                border: none; 
                                padding: 0.75rem 1.5rem; 
                                border-radius: 0.375rem; 
                                cursor: pointer;
                                font-weight: bold;
                            ">
                                üîÑ Spr√≥buj ponownie
                            </button>
                            <button onclick="window.debugApp && window.debugApp.checkStorage()" style="
                                background: #059669; 
                                color: white; 
                                border: none; 
                                padding: 0.75rem 1.5rem; 
                                border-radius: 0.375rem; 
                                cursor: pointer;
                            ">
                                üîç Diagnostyka
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Inicjalizacja aplikacji po za≈Çadowaniu DOM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Rozpoczynam ≈Çadowanie aplikacji English Flashcards...');
            
            updateLoadingProgress('Sprawdzanie modu≈Ç√≥w...', 20);
            
            // Sprawd≈∫ czy by≈Çy b≈Çƒôdy ≈Çadowania skrypt√≥w
            if (scriptErrors.length > 0) {
                showErrorScreen(
                    'B≈ÇƒÖd ≈Çadowania plik√≥w',
                    'Nie uda≈Ço siƒô za≈Çadowaƒá niekt√≥rych plik√≥w aplikacji.',
                    `BrakujƒÖce pliki:\n${scriptErrors.join('\n')}`
                );
                return;
            }
            
            updateLoadingProgress('Sprawdzanie klas...', 40);
            
            // Sprawd≈∫ dostƒôpno≈õƒá klas
            const classCheck = checkClassAvailability();
            if (!classCheck.success) {
                showErrorScreen(
                    'B≈ÇƒÖd inicjalizacji modu≈Ç√≥w',
                    'Niekt√≥re modu≈Çy aplikacji nie zosta≈Çy poprawnie za≈Çadowane.',
                    `BrakujƒÖce klasy:\n${classCheck.missing.join('\n')}`
                );
                return;
            }
            
            updateLoadingProgress('Inicjalizacja aplikacji...', 60);
            
            try {
                // Utworzenie globalnej instancji aplikacji
                window.englishFlashcardsApp = new EnglishFlashcardsApp();
                
                updateLoadingProgress('Aplikacja gotowa!', 100);
                
                // Ukryj loading screen po kr√≥tkiej chwili
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loading-screen');
                    const appContainer = document.getElementById('app');
                    
                    if (loadingScreen && appContainer) {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            appContainer.classList.remove('hidden');
                            document.body.classList.remove('loading');
                        }, 300);
                    }
                }, 500);
                
                console.log('‚úÖ Aplikacja zosta≈Ça pomy≈õlnie zainicjalizowana');
                
                // Dodaj funkcjƒô diagnostycznƒÖ do window
                window.checkClassAvailability = checkClassAvailability;
                
            } catch (error) {
                console.error('‚ùå B≈ÇƒÖd inicjalizacji aplikacji:', error);
                
                showErrorScreen(
                    'B≈ÇƒÖd uruchomienia aplikacji',
                    'WystƒÖpi≈Ç nieoczekiwany b≈ÇƒÖd podczas inicjalizacji.',
                    `${error.name}: ${error.message}\n\nStos wywo≈Ça≈Ñ:\n${error.stack}`
                );
            }
        });

        // Debug funkcje
        window.debugApp = {
            checkStorage: () => {
                console.log('LocalStorage klucze:', Object.keys(localStorage));
                const appKeys = Object.keys(localStorage).filter(key => 
                    key.startsWith('english-flashcards')
                );
                console.log('Klucze aplikacji:', appKeys);
                appKeys.forEach(key => {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        console.log(`${key}:`, data);
                    } catch (e) {
                        console.log(`${key}: (nie JSON)`, localStorage.getItem(key));
                    }
                });
            },
            
            clearStorage: () => {
                if (confirm('Czy na pewno chcesz wyczy≈õciƒá wszystkie dane aplikacji?')) {
                    const appKeys = Object.keys(localStorage).filter(key => 
                        key.startsWith('english-flashcards')
                    );
                    appKeys.forEach(key => localStorage.removeItem(key));
                    console.log('‚úÖ Dane aplikacji zosta≈Çy wyczyszczone');
                    location.reload();
                }
            },
            
            reloadApp: () => {
                location.reload();
            },
            
            getAppInfo: () => {
                return {
                    version: '1.0.0',
                    loadedClasses: checkClassAvailability(),
                    scriptErrors: scriptErrors,
                    hasApp: typeof window.englishFlashcardsApp !== 'undefined'
                };
            }
        };

        // Obs≈Çuga offline/online
        window.addEventListener('online', () => {
            const indicator = document.getElementById('offline-indicator');
            if (indicator) indicator.classList.add('hidden');
        });

        window.addEventListener('offline', () => {
            const indicator = document.getElementById('offline-indicator');
            if (indicator) indicator.classList.remove('hidden');
        });

        console.log('üí° Dostƒôpne funkcje debug:', Object.keys(window.debugApp));
    </script>
</body>
</html>